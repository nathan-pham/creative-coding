<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link
            rel="icon"
            href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ¯</text></svg>"
        />
        <title>Sketch 03: Water Flower</title>

        <link rel="stylesheet" href="/globals/style.css" />

        <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.0/gsap.min.js"></script> -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
        <script src="/globals/utils.js"></script>
    </head>
    <body>
        <script>
            let bg;
            let palette = [];

            let centerX, centerY;

            let radius, maxRadius, radiusDir;
            let angle = 0;

            function setup() {
                angle = 0;
                radius = 0;
                radiusDir = 1;
                maxRadius = 200;

                createCanvas(600, 600);

                [bg, ...palette] = shuffle(random(colors)).map((c) => color(c));

                centerX = width / 2;
                centerY = height / 2;

                background(bg);
            }

            function draw() {
                angle += random() / 100;
                radius += radiusDir;

                if (radius >= maxRadius || radius <= 0) {
                    radiusDir *= -1;
                }

                noStroke();
                fill(
                    lerpColor(
                        palette[floor(angle) % palette.length],
                        palette[floor(angle + 1) % palette.length],
                        angle % 1
                    )
                );

                const coord1 = createVector(
                    centerX + radius * cos((-angle * PI * 100) / 180),
                    centerY + radius * sin((-angle * PI * 100) / 180)
                );

                const coord2 = createVector(
                    centerX - (coord1.x - centerX),
                    centerY - (coord1.y - centerY)
                );

                circle(coord1.x, coord1.y, 30);
                circle(coord2.x, coord2.y, 30);

                if (
                    angle >= 16 &&
                    dist(coord1.x, coord1.y, coord2.x, coord2.y) < 10
                ) {
                    noLoop();
                }
            }

            // p5.js new sketch
            function keyPressed() {
                if (keyCode == 32) {
                    setup();
                }
            }
        </script>
    </body>
</html>
